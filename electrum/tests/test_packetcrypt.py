from electrum.packetcrypt_bindings import (
    packetcrypt_ann_header_numbers,
    packetcrypt_validate,
    packetcrypt_get_coinbase_commit,
    packetcrypt_get_effective_target,
)
from electrum.util import bfh
from electrum.blockchain import deserialize_header, Blockchain

from . import ElectrumTestCase

class TestPacketCrypt(ElectrumTestCase):
    # all 4 anns were made in block 399996
    PREV_HEADER_NUMS = [ 399996 ] * 4
    PREV_HASHES = [ "b8448da222c876ecb3f2a286df9be61c4ea13385208a336307d3f223369e431e" ] * 4

    HEADER_400000 = ("00000020274eb962b384dcb9498056608c7d2476ef61c068bdac66d51c23" +
        "7bd59844356b95722d8c9f1520fcc0298d27b8f48dbb0e407c9327bc4154" +
        "a26f778e7275c4bca31ebf5e6a11261dcf4d5d0c")

    PROOF_400000 = ("01fd441b20ff0200019ec601fff49115008000207c1a0600000000000000" +
        "000000000000000000000000000000000000000000000000000000000000" +
        "000000003d56725276d20fa825fd51410e46690404e1b74e6724974d2e82" +
        "dd1fbb0e66064be6be92dd974ccee60a469fea1cbe98e45aba1a844c5995" +
        "37e4caf2384950068a22fc6dc4282f6a32198144d48e958c51b82632b9c1" +
        "1666075c8b69e0cc5734160f94e473ee57088216c7787b82659e9c90ec63" +
        "872812f75e0885b66f12dc69fd65c7b46f78341d4531ddef3cfa1d28d55b" +
        "4eba231a922c9e559f3dfe80eabe7105ebab8c16551245481a15a307114b" +
        "d4d0738d5ed67818c19744b8660b2c14573d92c35d245128875ba5b00683" +
        "ea9762f4ee504642b0772714d09a18dc244e5f0363984677177e5db9bf48" +
        "c63d5e1629db0b3df4e0ec938cdfaf0bfd826c60edf0b2df3ecfa14666a1" +
        "d89d9ccc1560baada80e1bdaf840602a3ce50fb83b70b13bc83c2e50064a" +
        "0b314f1581efc6a7b4d010a13b42ac662b3507d9612845bf02636807c9d2" +
        "120fa9250e88e73e00c7d28371b430113eb89dcf843691ca8a455731dc53" +
        "4625c5984df425ba61345414bc3cf96e9bf177d3c971d9958092164c2a9c" +
        "19766b225ce4864b38f6aa29c58901b8a104e2ca9a9e9dfffa991f44454d" +
        "9eb8a9eb2057af35168d4d4ad032b6d91fabc1b7647e0d8591dc3bc3e165" +
        "4b1658c2b3c77476f5a7ce99f2fc6148ccf9a277460c08a1f08c9d7ecfa6" +
        "63f0f2a678ffef1c601e7cb81f1660bffdf97f78937507b83fdbb10d110c" +
        "2e51454006745bb731e2065e39a5776eeace6442a3a3e9150fd28072a25b" +
        "fc3719db693d70597e7457619dc5d8c0462550efa6fb47cae57cf0aba947" +
        "3de147234ddd2d863e613e8c4014c82436ef297c2341d6b8b83f012d1982" +
        "28279c8255874ae881687ead6504ed4d86bcb7285ca8208b79c73f2b1802" +
        "394fd3403cc32587ef26c94f2fc9d21d69179113a9b6133fbbd51e47827f" +
        "cc419beec55ab0975599325ab1633f8b7ab50cc675cc3b956713189889df" +
        "427a22299aa19eaf20c19cd2256380b38199bba4cd61ab9fd8717ba258d2" +
        "c23ee00641301850856966ab6d821d94fc195a30b5d7937342d7f327d582" +
        "baabd108085bc7d4395f9aaf428a0c4c7888b4bd7e3521811365105ba179" +
        "6d368922af336a3f0b71a99cf63b269c209bb722e58999fbb66670516aa6" +
        "04854a2a0f691c2084e63876fb54790ee7bda0abb9aa8e0f2fbcb446b39c" +
        "f82e65f06a6e3b731d749235b9ac78328b713fa23390e1dc998ab8756317" +
        "b5110a24ef7fba0cd41994b41e3566b758debd6052eed4d8784c4f1234b7" +
        "f5be703e6bd49b7e653f2cc3e6fd9e3cbd715575abec351f2b0ba9de2c6c" +
        "9f29309f0a7f22b6e6f86401ab1e77018bf72113f1199204f6cdd071f1ae" +
        "d891366c017aa25a55555bb00164300193075666008000207c1a06000000" +
        "000000000000000000000000000000000000000000000000000000000000" +
        "00000000000000003d56725276d20fa825fd51410e46690404e1b74e6724" +
        "974d2e82dd1fbb0e66062de7fe0bed2a40261bf07f661bfb372a485f50b2" +
        "0ec9ba46d70fa2a34c72092b98c1151d9891ee0759cd7e15bf4a68d72abb" +
        "f4ae1f2b0c56ef7daa801c3baa932f40024035da8576dec1117990f2fe85" +
        "5e40bbe5dc4646e56c70748af3b823a82357e72e71d2a10122060aae84a9" +
        "57f001abdd8793d0fc38ce0f71f44d39b076b0f17c68c43253c6c64d5cd6" +
        "0ab9175ddb173dad59ec3d503d27802dcadc411abbbdf771cdeaebc5c7ca" +
        "fca93fc691c690ef7ef599a07edd28e4b60169429d9fb20b3e032ea169b9" +
        "6dca0a6b498d85bc0632bf98f193763336b93a57867627629bd6adb26394" +
        "debf53a9d330a92b7b2c8bfc0878a38459bde4c0fc2c9cade25ade215ac2" +
        "cfe690a4ae834f26b1a29f9b1b82f6b2547ba11a6916f79657c5361f3e8d" +
        "8fccf71118442c3074f42fdc74665bf79f69eaa239e4e3bb83764738e65a" +
        "8551d4858f55fd01305c1533c33b49670130df4fe36f0d4c82b7709eac47" +
        "af59aa0b51dc94dccfde6fc6d2daf4e9791e3be9727278f4da2f965f4513" +
        "9db491ba4ea0ed8395e9107cd6249779d64a67f4c205998eb45e480a811d" +
        "290e3be4bed97a0b2d492834c99b3053b5d34891ab89acb4df36c909ba6a" +
        "edc23ef6962fbbc4484cf0ab6e50fb44a829a2379a133da0e922667f9fb7" +
        "c52b5b729a6eb03bb9301c9733b34a2b8bb0b2933fb0f11f35c7c7f722b1" +
        "40b54cf2472c2bdbc14c8d3a9d85057b1bb29e12f13ca21bb8f5bdc589b8" +
        "68e5d3170de5fc92e8e242cf49a4e69feeddc7693cf5f0cd27ab6b35589a" +
        "b95fc20ccf438b40fe071984ab69f29c9c26831c7326f7b22d8f82ce1982" +
        "3e586d4cea2dd491fec8d34381b7e93dcc6766e2ee656ca73699c5130877" +
        "666f05d9178199a0ea4bbab96b106917f5338e796dcaea25e497de4e361b" +
        "a1f26eb9ad647ee84f5cdd6ed9445eab78636c3054506df325fcaf74add7" +
        "aced7f9b1bbb2c310772b5edd788194686d8e6f885289ef5a4d372abfca9" +
        "85235231c2769531e910b61f9e401b2c22e05051ceec74e9ec645974eaba" +
        "d898b54ed15d67d3d91ee2b06c0d8bf3e94e401abfda13e2f3cc4d5424c6" +
        "07def44907de4d21cd13672bd64eabd535795a973c4793109198314cd7bc" +
        "014a8e428d18556dee8179cfcc9ac0e326444fe8296823efd26bce2052b9" +
        "282a9b8d450ccdd790abd2d4daa1b03bd21c01aea68d029bb1cee9b6b74e" +
        "64cd799d4f4c02125fc50c9228dc41a3f31de102c0a3bf89f1a71388092c" +
        "bd60957ec3deb5a29c7e5afa3e41a1d6a5ae6874f0f85c5f868f7d347761" +
        "a8bba93223b86ce10ed3729cca83979f013a0e00beefa86d008000207c1a" +
        "060000000000000000000000000000000000000000000000000000000000" +
        "0000000000000000000000003d56725276d20fa825fd51410e46690404e1" +
        "b74e6724974d2e82dd1fbb0e6606d32f7df0d14be27f94c6d5868eb824db" +
        "6bd961cb383c73838ccee80cd995554007eb0cc2c6d30391577dda6ec93e" +
        "1b0ba266553678f04a983a2797de2ea23c65a49e2ab295225e06be893e18" +
        "d6c55843b36ad1d2b19573c2b73925d2e1f9aca31f35f0cea0b2129550b0" +
        "5bb8ac8528f830cf609db54734cdda51e2a3d19e56bbdbfe57dc7823a6a9" +
        "a764eb5d48d899881771a9e0d4628cc7668f6b3af0c53c21517cfc5f4eba" +
        "2373d8c60de98cfdab76f0347c1935439ac69e6df144553e380993273b94" +
        "db44b7c9c17b6d00ca392606b7db8fe9ce64d755aa9beba6cba101f0a039" +
        "f96a21f68645e7f3943bc22bde4808b2ab9576b655c86956020f957abc77" +
        "e5f2334ea7c6eb9095b94da1c5647f98543c924eb7a2c84b52bf0dd48bab" +
        "84bfe0559958823f06549f29ee308ed04d1477c589afd81c7542433a93bd" +
        "73d77a2f84a2f9aed2efe780a03f3dc56850fd12193817d7595eb2197711" +
        "a2ac741efcadfa4a0dc89d30e85284c6ce5e530a2fe3042b342312dda534" +
        "35781885d35af248f2f844337b5410aa66a9b6fdeab3a7ba4a7b5c1a28cc" +
        "34c77965f9c96a522446ec06057bccdfcecdc510f202fd224444b6b55031" +
        "17bbc0c4f108812199625b9404ca9f288385a1185739e8a37aa7050280ba" +
        "edb2d244b579dad2c85734f20e9353e670f6992ebf85cf48a77ba4164784" +
        "a191f339b15cf14c26ffd326474c8e72f2854099c8391e9d1ef5c41e46ee" +
        "4c191851c3f39a5ccfa739992398399467abd4e5e5fa1b797f119193dea0" +
        "797a3add3cb6419986c7f661c93b47c387de966d5ba3d574cca20e3f9e47" +
        "c589796dde9d24f4c47209329c71e7a34631e86ea156783d2fd44eefda1a" +
        "65fd29b34f5eeeaf5cf85b8f46c4b8602bdc490cc67ef1130f337b2aaef4" +
        "599de2bbfd275325e520cfcaadc900d162b98086cdc2fa95bb4b0f32c776" +
        "6d41925be9d3311ddad0d621d6c47940f3378df9e36fab23c78f8685e44e" +
        "cd3ca5fc968915851dc4aecc025a60f3764437f35d30db2df7063c40623a" +
        "eaf850bcf7830419bf1c84470e77b164e1baa52aa54e847a7ceeceb2e5e5" +
        "c62d935f461d996c4c59f093c5316cd37d7dad23e659703d4c1cafa7a5c1" +
        "20a6911f1b6bf5a2fb202e5df68172527ee459d810984c71c26986e0d116" +
        "d33b0ddedc1e3d811e0e512ad6cad796f52502072312f56336bd3ee9c718" +
        "42f53510c70b8c0735efc4c4af0f639bc3704ca1b227f510b21d64d55d5f" +
        "476a6b20c2af93eead7b631dc205a141cb240c3871ebffa963b2506f8f4d" +
        "df8c637967aadf3e40cc25b3022f0f27a9b9ca18011a3c00e9a4c9480080" +
        "00207c1a0600000000000000000000000000000000000000000000000000" +
        "000000000000000000000000000000003d56725276d20fa825fd51410e46" +
        "690404e1b74e6724974d2e82dd1fbb0e66065ad1d4b6ad5b97a7679a9e5b" +
        "1bb38ba3bebe170f09461ea5a13ebde40f1eef45bc534c56f7e92d6101e5" +
        "18149a2cd1bfd234d005a0fc876043fd0339963d03e5ab72cd4075121121" +
        "0f7d26d1f73f7b2f06f5c0ab3fe0d0520807e3fa4f6b1d7d92b6ad7ab4f2" +
        "a44ea23835ee0e45a7235566058a01c3ddf71b8f730d595869634b102039" +
        "155d66b8c036dd60c1d2282d1439b907b8e5bed44a5b59618505244720ee" +
        "04e9f50564566ee071ab5bf91b88b360064909547d0d4a1d2e80cd284d7f" +
        "72b4695390831e4c3a2adc08c7dd426918383c75fc252ad8c8942ae93533" +
        "8771ed9be9669b2a05c88ddb937125b0da5998d71c446dece7de3569ceed" +
        "10aa684c1e5a1aaddd72e3ff1c7b7ae0f2de823d123f423edc24b3aa7dc1" +
        "d246179b17798e0eacfbfe530fa35e30c44b53e711e639ce4abe81bcc5cb" +
        "c89a6b061e8e724b0cf7718fed8b798dcd39cfa0654cebf500b17533142b" +
        "a7c8e6b6f55faf7771138cdec5796e7195f085cc83c5b43cec92af4fcf1a" +
        "660bba83e104fc2fdb6a0d3efdfb99fa47cadb794c3ebbcf54267ceeb968" +
        "0e52594751c22e6d5016fcb9ff23ec1ef7dae007d50866eae9e4d9030fd4" +
        "d4870f59c989ce25097ef7d84c5e3ebbfd34985b53915728cf3ef9171e36" +
        "28cbe75078b87c60f4b9187c676516e30d0d442e7f4be78994a0a0446a04" +
        "94e7a02f7a6d108a9de94ac00ebdaa2d9f1306b5a8032970eec6081f07a9" +
        "0605b1f884d85ce523bbb3ee1a03fcc1e71fd5592efe6c1a8062e2738555" +
        "77c716808525369c02a71ab50d2973f2ec7a5ae4eba11c724ee69c001555" +
        "1e5f220d089b86e0210ab5b9ed4e7437e403ee5f2601e5e869994aed84b8" +
        "5a0e53c141486c4be4b0bbfa9a459a6468a83bafa92fad45f1257527c225" +
        "503cf728a0046aaf1353499b58b586b79fb564675a3f4acecfd9ed687587" +
        "e89a14eed2de7445f94375dede5a920aadde803bc06e123e0b3350c32065" +
        "717a7ab685467889e5bfd5458d20613a00cc9032b2a2c871857e6a22c000" +
        "8994881ae55fa1c07b2f7a1731a6abd7c2e0c7ca2fd8b38d25d249faabda" +
        "df345aa29199e940df9277ab9d612f516f7d493989a5d768c63757a9469f" +
        "d1db712e4a436da4d985314e86b1bb5392fa5cb10c3a20963948f3515701" +
        "4b306081b4e1678843744d482e35e4e15594f03b5664c989267caaedcaa6" +
        "a7633754447e4997164ed5d9c7f41ffc33937ff001d9138ee1ab081e9cc6" +
        "5d6f87bc3567b7974e0c749e97a59722580cf1838e9580c11b9d47f424f5" +
        "b5792cdf9c486f1c8ac3d4e91dca83279dbd6fe19629d4e8ee77bbea7e3d" +
        "f51dbea97600e2d8a7a8ecd3aeae4b00592ca972b462e9009802ca3560ef" +
        "dd6cf6f703bffce0bb1a7907c21019f67ef6a892f67cfb17162b0e998021" +
        "a05c895de2a556ac5c1301bfdc32fb02eb9476d1c20349f678f3027f207d" +
        "a4af2c99314cb7760e8465852834fb047a8046a1a085d17793fd6a491475" +
        "ec001a75047ffea26c3c8741da683ca364d81408e4e53b906b777f3abbf0" +
        "c846402fa9be22f0ecfa0d00d034f2360eeebca884b7c60dcce7707fb95e" +
        "6c8de0867c08c10affa9dc92d88304fe735ec86b07008efed6028985aac5" +
        "da5741d3f279473fdf9ab27bb08f9e23b8074b7dcb41e0bf8a3cf24bd3aa" +
        "01005573fe99d63187e8b59be32dc49dc52d14542e2d4b39e36f03c11b96" +
        "02738c0eb63097444eb0342aa4b19db7593b19bae03f9615a45afcba19de" +
        "3f1fe3d17dc2386ffc6d823f0000ba78b60ea92c000069684bd9c951e787" +
        "e7da4fbb4f708590356ee3c5221e59ffa5a7e03ce75466c858478d72027b" +
        "0000de9292f80adad90db7eba448b6c61b0313ea1d64e58225b6c736e074" +
        "07c63455d8ff9812a96e0000f5e40f44d01b7e1f261789a9f5ed5e0cc6ee" +
        "49776d39caf81497d3cd5f96123e09241a5640fc00008557d22707d93f75" +
        "30a9573f37d218f56719da1b9d2a13ef140f16d7b5c5f284acf0d6eb7953" +
        "0300459effc973def0159a4304baf91aa6e64ab17efff79b8188391d9bf1" +
        "84e90811820d408597a21e0082a5a0cf4cb05ce772c82ffd85d9513099fe" +
        "196cec192edc017613d24092db96f1795dcbfc643f00b9bbd7063b05bfd0" +
        "12240a832c52920eaa15cb030c95553ec60e9f249811f181e8f54dc2a6bd" +
        "74006c155ae36e8121e093c38fb6d54159f84d6d2a3e93da59ff085a6786" +
        "e046873eb8a3a6803783d8012b48e813ff676b9dfe531ea49e0dfae12e66" +
        "280f3b2ca0e8b3cf743f38f29bddf8eb8c872a5e000f919e2043e30a3bac" +
        "d20b4fa68950daedb77d0db167fa39f168ec3fdf4d7d1f1de0ed03d0157e" +
        "b803852f7a97e4ddfd9ff5b98dc6405a601b66d7603a9952a3c66f722eda" +
        "73400901eda29964fcfadc012876bf9612572be6c1ba459956e54c4394db" +
        "c5b65ffb0576a9075a96891398b1e667267eb9fa7700718535471aceb409" +
        "5c8e4840312f5636659fa010171b82d82932c31b904a9e13ef4b9149308e" +
        "3a005d9365a9deb3cee0dfa2f1ec6cf9892d5ae666a5cab01eafd01dd927" +
        "b7237812c2b72659bf791e000b690d9276ca4f8bd3da9971853b5375a3e3" +
        "12da6954bdd5c7bb04abcd3744808948be015f0d0f00b11660b9a2ece247" +
        "203dfc72f26d05b7f96b3255545f38adc96c2c5f7458841d5fa51ffb112e" +
        "070043c2d2977973a8b65e6e2fa152386beb455c482919aef7c15e48a7a9" +
        "3992c39071bc589826820300d53d4798a48686a3ec6944c6da7112b3cd2c" +
        "73af66ba3fd000cb67347790c7b22f598337ee230000ebedfca69497af22" +
        "f6836dba082d5765f61e9c5900128158a16e5faf38ce2c2fb7f0cfef307f" +
        "664209abf9382486b13f6b1906a60bb2e47bacfc5852024c844c27ade2d4" +
        "481300009812ec54c04100005f52b25437e8b7193ade364e80fd7cf6a987" +
        "f09ab345889e560c9aeb41a09715ba8ba9b67c310000ff08d00fa69890bf" +
        "fffcd5d14284b5445633feebd3d33897379af58dcf79aedcef4b5d187c43" +
        "010071897d614b3bdf5216ee5842daa1ec65977d7e548d7d534e6952e70f" +
        "7648b3e4cad184a0bd5101002ea4be300ecc539bc4142256005e8d48f8d9" +
        "85fecf32974de1bb8325be78f031357a37889e82ef004712ceea2310582f" +
        "31550b7dfc3889f96b4ce2d6605a97ff21e976f410552e48c93ec97684c8" +
        "7307081dd5f736232c97628460e8584ce39b5659abb73b2b9658a9c5cd07" +
        "fa60f24bb6d2854a6d6e0f0f4177e229819174423f8f80f71f6adaaf1d21" +
        "5663cfe3b5dc6d0ff03e3f5f49de3a1ae4a3b9131b1e762ceae48d36f084" +
        "f51c0ae7e6c3d04c6306860c5c255697b76a666b4672e6c04daff55dcfba" +
        "6e07f442804351c0f75dff4550be9dc0dbe264dd1336fbe4ec7283a6441d" +
        "27990a5823c73acec04a0700a85cdda3873af543d87271853fe21486e39c" +
        "6136a855898262c2a79f85e97d8aa5737d8aa3390200548a4df1fb7151f9" +
        "a4ac107e0d98873a92e5e39549d1aedf8f81c489c38b8eb7ee6dc3554a3f" +
        "0000b1581696f92d0a2888210f5206d2a1225a80e648298a521ab08b6169" +
        "a72882a90792a45a7b2100009c1fbe075dc9a23ba28a1c14fcf5443ab7a5" +
        "e8ec32b2ad6f362f47823fe00417fcf17f73b6000000f67c2d346219707f" +
        "98cc28d7c5b9446cdbcf4378d92fda981e4cef2842403389687f5d357b0d" +
        "0000fdc3d205589a5c258e7fd3cec1a8d3205120b8e4d27e95f0a59309ba" +
        "dd36b329c13accdc172301005c09491b592a9ee8955014324355b5173d9d" +
        "f97f6e0eab77df0acaea9bff2c6e9bf514cfabcf030094a8fad26f731387" +
        "0f69f12656797489d7c5580f75b5e1c1aa203273bd91a2eab8eb3f7559a1" +
        "0f0061aa4ee9b12e78bd6e2f09ce5500ed61bb76f2ca44a6d5674d7ce91a" +
        "48ff6a704b11a846b9d41c00a1e42ead024946f20e603ac32fa5d3b04a96" +
        "296d82d85c4b2f09d3a13c3fdb7df1aea12a47093d00a9d828b0757f3054" +
        "11a76f408b8a9d55476f4249eee820b0f1f134ddf132a45a3df634d73aec" +
        "75005d94d0233bce055ef64126489386515de2d78eb9a96d0d985f269553" +
        "7d965f889c646d0346a0ee00ea7eeca0933e1ca2bcfb12b1ecc83e617d87" +
        "19b24bd38e16c4550b6823f41293e38a7579d829e201ad5a3ab8ed4bb8e8" +
        "aa7e8dddbaa953aced39e6f9f029e116e08eee38695542cce5509cec2c1d" +
        "c103b16974ff66645cb7e21246ee42482de6b050c0c81cc6cded1508bc98" +
        "7e7c75fc2189f4965d89010f77620bdb929f0c914e63d15a3520c499b7e4" +
        "0e30c411ad3970650f5a2f76f9e2e29f758d3e52ec0e8ba4fb13e2695b69" +
        "03c767f7c1bff7279c299322510c33afe3acec8b79873c6239f1af5204c4" +
        "6407edd332ee2c68f7039082c5da5d5f0e48932ee4bae7a1b01bf5e1fa6e" +
        "3f2e658c21a0958e1097c50370b987a86a6c36e265b14566baeb98e697cb" +
        "b52dabaa57d71fad1551e4c49101b4a54f227bc5d80136401991b7342ac6" +
        "d8f0517149b001605a72d2a6cfe8fa77d532531b52faba18d750c027170c" +
        "75007945837b9b4248a13894dc2fa94fcb2c1423cc3f03b76cb65ae06c74" +
        "ef4409536564eb08846b030044892746a47aa57aa6d6c9efa3249e45a4f1" +
        "7851ebc1f3b3dacf6545c95da19881845204740502003750caf0f787f9a5" +
        "111cbf68855b99c108b1e60bffab8c7a9a7ceecdbe4ea577a037810db5fa" +
        "00008956aebcaff4122e1cc9c3fa5db98c419f2d72d1a02f89be664b8d2c" +
        "eb656904efb573c5117900007496a48bf3ba68bf1a7df2e012299bab9d3d" +
        "47a7ad0982162ff06c7a3df7e328df523dd76b1f0000319f0e80c70edd94" +
        "bed94eb791f381beb64b443c894ad029ca77299f67cc8da0b7fa78fd1105" +
        "0000f2e157e4581a4bea35ce61ebfae242cbdc6a9bcd5f03f0e442455b46" +
        "a9eeb0b3a1ed0a5ef90f000036b95bb5688b53b20a8a5ecab1bde37513c2" +
        "460ae266a4920d7092168b79abd02924254c9d82070063144eeab536abfc" +
        "97ece0e06d939de9caafaba982ba4b3a47ce21aaac05ccd610be516f814e" +
        "0e000452fb6300f77c66cb3e86a65e91d009f7c3c5ffa7e86985180c4f02" +
        "643b4d25524e75e6cf3b1e00c906eb1d74d416926087b76d8ab05c17cd1e" +
        "6795aa2be7521c72654679dc3322519b3c7481f63900b94ae2026346e1de" +
        "d15049f6954806cd0cd0dce4f3e453d1fd03131e070ca750a76797835134" +
        "f2001465804b9e10ea9fd4fad94616196ec9c93de0fda8da769fb5db16c3" +
        "1d6cb65f4f57efe99f27f63b49a80ac41d1ce4692e72fcf0f62fc2f145bf" +
        "c887cbfde55eadd6067de2eb0ae256cee9683c055610ca29567be78f7ded" +
        "cf9dbb365c2d2bd1e0940f34f3e738a5443cc12b6df1865302fd0001ff74" +
        "528a7401db42933df3e63262dc9cc1388ad8204abe0ba3c15f922798eba0" +
        "1f276e1575976f05b04254f14b15e075d4e57364a3199e063b87637a38b9" +
        "6f0f9da4692cb282ded198b838444f3a4f33685a667dcc29059af3de87cc" +
        "1c99bc65be4233b3a54fd82d7f4163960a75e7630c0238471934ade4d3c6" +
        "08fe235e87048dbaba8239bc6f2d5f35cbf9d808a07db4eb4d0c6ceae076" +
        "f2e06219143224a8045866d2b5d566efe03ea4d33705a4470cdcff620b8c" +
        "e194e194d8d319410f0d728496d0a547918444ed24f7871660b2bdec04ac" +
        "05702bfa96a75805fe357133a187c1ac800c96d89d8f678ba5e569ec2122" +
        "5810271f0b1b20b5e0ed69a664000401020000")

    COINBASE_400000 = ("010000000001010000000000000000000000000000000000000000000000" +
        "000000000000000000ffffffff1103801a06000b2f503253482f706b7464" +
        "2fffffffff9491a1a4051b0000001976a91426f3919691f442568e3a8b47" +
        "5017014c3d4b779188ac93f39d5e000000001976a914a51ead2bc76237c7" +
        "62af9a22069c8b3a4d54c3f588acefcf7e68000000001976a914250fb86c" +
        "a4a0fbe99de96c70c9e686257a10864e88ac6977554f000000001976a914" +
        "643d5a6c1373a44dfb5c64e6c6c17d87fa1eb63988acf715102800000000" +
        "1600141d50632ff818313f237df9986b38b92b9e374da944702411000000" +
        "00160014e58c4b7ce23405aff66580e9e09da4f4ff7d4d902ec7395a0000" +
        "00001976a914821634c0f17148aa27e9f8f5d6e3775dd7991ef788ac51ee" +
        "ff5e000000001976a91456bc3b4ba1b76136da6fb896ae3df9837a32dab2" +
        "88acf75667180a0000001976a91460e64d80885cd7eaeb2bbdf1f6d416eb" +
        "84c7089d88acfa2be44e000000001976a9146f4c40677c776d2b3ad10e2b" +
        "5191bd260f1ad6f088ace04a2e5f000000001976a91481089524622c1441" +
        "74ac3b58a8df99d7367eae6188ac519a724d000000001976a9149659a76a" +
        "54352ce9779a3b26454e2a9ea3eb2e1388ac2972895d000000001976a914" +
        "ccd83899ff0c7cd63fe888fb0354fb450189e4ba88ac484cae6300000000" +
        "1976a914fd8c3dd39f82cc72d3d383987db9c09a78bf494788ac4bf39c64" +
        "000000001976a914bab83b91a93b2f81343662ab3b68ef7425070c7c88ac" +
        "8bd6a65e000000001976a9148921cc8ba439f022254a4fd7e65fd4996bfb" +
        "04cd88ac1e851b8e4300000022002088e6ee9e4e7f31050106f8f6fd5926" +
        "77e5f0182219e8b28e2f932b14cbd2515ad983acee0c0000001976a914b8" +
        "aa33c3e10d835416618c4946ae8b6162bc0d6888ac918907480000000019" +
        "76a914e25afdabf9f99b22f2d3c7e72f51dbfca6a1754788ac615bea5c00" +
        "0000001976a9145685b8167a50ec100e9828f31df26ece1a43379a88ac09" +
        "085954000000001976a914d2486e0c258bff2b31f741990e5eb841491c09" +
        "1288ac99a6640100000000160014fb4969874f649c2d2b97681f1d7ddd85" +
        "1ffb11b019b6f964000000001976a914efb0f6afcdd98159474e3d82814d" +
        "fd24e711d57788ac3b69b44e000000001976a9147e80fdc64aab6781a4ac" +
        "1997d64fd318566f96a088ac73c73154000000001976a914ea6382cd2162" +
        "87563691874b4bfe1101f158491388ac3a8c9c0b000000001976a9143c0f" +
        "7da6d66c40408900cb02d6f3b58fdbc466e588ace2456860000000001976" +
        "a9148e44c5b2a6a9fb55c685918f2b172358b52ebcaa88ac9e56715b0000" +
        "00001976a91489074dcf41e729a6dc1d09f2e3a040cab6b5555f88ac6202" +
        "3e42000000001976a91408545ae98d42bd61104e8bede75956f802d8328f" +
        "88acdcef6f03000000001976a914de515f5ca308249cd98b7a95c2983849" +
        "bb340c5a88acac17a759000000001976a91412f558fad7429bf04463862b" +
        "f3767a81fd1894b388accbefd55c000000001976a9145f2e1de6a3796527" +
        "745aa4c64a6a92882c42ebe988acbe6a1331000000001976a91459d38630" +
        "8c091e3bfa70112e046b0974aedddebc88ac40830b64000000001976a914" +
        "5361cbdd89c85c5f0e52b5f50c082f70f6c1d2c788acee4a5b5f00000000" +
        "1976a9141ac7cc6440b9f7251e56fe1a736a71bfb07e3f1e88ac1e210152" +
        "000000001976a914f18fd5f53232a2571c3d267630cbdd91576838b688ac" +
        "4e90f667000000001976a914003038c211a127cb27fe087c2000630c8f42" +
        "6b0088acf49e6855000000001976a91441c426d4a36f71fccedbf9e7d62e" +
        "f49251161db688ac72eb9044000000001976a914bc43175cd2b4d1717e54" +
        "dce3a563924f58b9d69788acab063661000000001976a914346c4de54cb2" +
        "ad7669e9ea1ae19a167c367c8b7388ac05dc6862000000001976a9140d29" +
        "17c62a8eb2812992427474c8df733d0e0f4f88acaee06e4b000000001976" +
        "a9141154a2a15d0b3b99eda71609e8705981bc1073c188acb2e6794d0000" +
        "00001976a91422dc975de9c156d22d42b00c3e65cd80deef5e7188ac6c42" +
        "c558000000001976a914f7c4b9d30b78384c43859a9793ffe60f06c6c0d9" +
        "88ac6e74775a000000001976a914d56153294b961437c783924bd0ac33ff" +
        "c348498588ac9b3bf261000000001976a9148653cefa16e35bdb4377b431" +
        "11310b59bbc634cf88ac72cf0960000000001976a9140fe64eb4a7fa9a26" +
        "068caec5e011fc40d7f0666988ac581af950000000001976a914ede9f619" +
        "8ce4f1036bd11032ae44ef68bd8cc02e88ac33cb3760000000001976a914" +
        "f96b648e6435e80434d8d160fbcfb42dabf1e58a88ac3ce9f15f00000000" +
        "1976a9142534558f729b5fc9b1420b81d79fb6e1da414b5688acf6f2dc4e" +
        "000000001976a9148c15c19be49885a61eee772feaf49821ff250e7088ac" +
        "002cbf5c000000001976a9146b6145157075dcee9d80fd5af94f45b594b1" +
        "e4fa88ac31081cddbd010000160014542476cb0b2e6ae7f5fef3fef42c1c" +
        "06b758540d08368b5c0d0000001976a91412c0e536d7a2825256ea63d4f9" +
        "b0d466d41ca23c88acd96eb460000000001976a9146144b1e0ebb0dbcf19" +
        "5d350c782701ad57bad87a88acdc129479010000001976a914a56d7a0c4f" +
        "c9a862e91b2a811424912abb156b4788ace3f24f63000000001976a9147e" +
        "e831cac011e3104199cda0be21c1fd6adfd78d88aca75bcb5d0000000019" +
        "76a91476a9756f861a076d7b571f197402be08977d17ff88acdcbd090a00" +
        "0000001976a914c671e7a31fc9c134d673529663438ed9ba7686ed88ac29" +
        "ca174f000000001976a9148c7493f46eae275ad44646c2b9bb850ffd39f6" +
        "2488ac953b1754000000001976a914b47df7cf5b79fbcf6acf47d486ace1" +
        "bd281df90c88ac4da9fd5a000000001976a91439e31c7812969287e3fe61" +
        "60acd8a7794cfa0e4b88ac4aa1e55c000000001976a9142b0ea91e37f24a" +
        "77bab3c97cb79335de6bbe3ab688ac7187fd73010000001976a914cd5bfc" +
        "90fcffe030d3483ea8869b6beef5a5676f88ac9df63850000000001976a9" +
        "1423f4cb5c2fbd9a891bb217d3c3a855202bf282b488ace1ada44a000000" +
        "001976a9145920b25f1572cfb0f578b47e95725af592177aad88accf9537" +
        "75010000001976a91416d5c8907034b6cfd1976706d66af9633a7a19f488" +
        "acd0dac150000000001976a91481d831fe48570246c2266ac2572a384dbc" +
        "eb3b7e88acdd55cb47000000001976a914f65879f23c5f26806385bb216c" +
        "935d8e71d899cb88acf0008563000000001976a914700bffc4b80e91d06c" +
        "14ab0c2faa08debc2690ca88ac30963c5f000000001976a914ff2059325a" +
        "0996f5b844c4e524da55393e25172e88ac3efe6e57000000001976a91425" +
        "3bf950bdfb6e32776b3f8e9627e00405d78ce588acc8f1c25f0000000019" +
        "76a914b1e7365f7a766dcd1cadf848e1c56bf6298a113588ace6be605400" +
        "0000001976a91411657af63ab94a0ebca924b697f239cced6587e288ac3c" +
        "8db3a0040000001976a91496c9d75d9996382ad14cbfc9dee97d5f0dfca3" +
        "4988ac839e3965000000001976a914f83ac06691660dcd0f517572499b54" +
        "5010535bea88acf47fcf63000000001976a9147577ee16f6f7588011b0fb" +
        "3bea5d62edb413cef088ac4590825d000000001976a914198dadebf35b67" +
        "5f80ebe17c9435b58aa06ec7ef88ac7ec13c59000000001976a9144520f0" +
        "43a7e66cde0495bd8a5e41ab426ae0daed88acc69b8f55000000001976a9" +
        "1483d0e073de4d026c7450ad5e3ef1c52ccff79e2488ac46e1544d000000" +
        "001976a9145e226890c5ad458c87691cd6b0adee1c7168803088acb3e2da" +
        "0c0c0000001976a9147a4f03829f34115b2b8f2377c4d235fd450a357188" +
        "ac30634061000000001976a914b80d77a5018a9e1f3cf577ea6bb7ebaa1d" +
        "42759588ac7a2a3562000000001976a914d1adc30e0d30036ff17631f8d5" +
        "9214de0aece77488ac171af35d000000001976a91418715d0f841fe33475" +
        "12524c5007aac5bf2bdcfd88ac32f65177010000001976a914104263c9e5" +
        "4b9ad2cc9b6984025f3db0a2b31ffa88acd2dbc661000000001976a91475" +
        "f8979738411b789de2a7468ae765039101a8bd88acb467414d0000000019" +
        "76a9146f1d16d86f690cbe771e8f3c744a0f1f709000ba88ac714d7e5100" +
        "0000001600145567b88df0ff2e48d628d8bcf4c7ac7e63abe0b79aadfc5a" +
        "000000001976a914a16f4470b9b34e6365c13a5e7eacc60ceee6371488ac" +
        "67cfe55f000000001976a91423bb91a5630db73aa367707c93e7e402591c" +
        "98bb88ac60b56e51000000001976a9141522ff62a7a6e32e88c218284bda" +
        "3f5345ab16f588ac0938da02010000001976a914cde2bcd510fb6f0fd610" +
        "a585eabfc7f87e37f1c488ac19f77666000000001976a914fa963ee974af" +
        "e42d2421725dea64a4f9189fe00d88acbd48ac62000000001976a914f606" +
        "988cbe0b177cd6edc7a6ac3e1e5778d06ef788ac2c49e12c0d0000001976" +
        "a9140caad39fee7120522e97f004f8b4477a73a2a07f88ac2b6c905b0000" +
        "00001976a9141870a58a12375634f6f9c20d0cf2df56f987a87288acbb73" +
        "9062000000001976a914bfd760c3edd12c463bb3dbd1df0b22baef7fa294" +
        "88acb14a255b000000001976a91474af55aca15e9200bda6bf7b0ef21f36" +
        "1dbc8fdd88ac05ce775b000000001976a914d83d8f6494b3e276077faeb2" +
        "8514b612701ed2aa88ac02bcca5f000000001976a9143be385789346dfc5" +
        "ce7af7d0e6959e4e01be866c88ac7f6c4552000000001976a9143f3453f1" +
        "04f6cb0f25936a7c966f1b5f59867efb88ac1097ea49000000001976a914" +
        "44daf72baedaffe4ec0f4281e695e566d0e8a1ae88acf558cb6f01000000" +
        "1976a9143b10501df5d81272dfc6b3fb92a1e11590c22c3c88acbbd4804e" +
        "000000001976a914027f0d64a7e48ba8d340acca8fe897e7f234e78d88ac" +
        "9ec2cf0a000000001976a91483c1fe255b57c0ea8e34b4cf32bd12e2adf1" +
        "703988ac9db4405f090000001976a9142e192bc9d7c8a0cb826caf358562" +
        "6b6e92e96a8588ac35ec6ac3010000001976a914de3623495c2c4af59945" +
        "c165349d9fe3dfb938d888ac8588b263000000001976a9143fe10efe7e8a" +
        "3dbc63946ec91dfcacc47caa081488aca322a245000000001976a9146bf2" +
        "ae01841cc0d5038fec9f3c46de210d02afb788ac388d8561000000001976" +
        "a9143269a0413aa69dbbec061bc69a9c7b20fba47ed588acf2735b5c0000" +
        "00001976a91449b236113bd7d287793ec84047c2a9ea903c0fe588aca78c" +
        "1f44000000001976a914e667d77d1fd0c93f4f90c1f76caa629232e35d6a" +
        "88ac762a7a4d000000001976a914d4171c34b162ea3a6c4ad96bc96c2527" +
        "7839c72d88ac10726f4f000000001976a914c5da78b1256859483667abe6" +
        "6dafc84964330e1b88ac6fb29463000000001976a9149238646c79a40c8d" +
        "8a16abbb7c0ce71b5fa96fc288ac17a4000f0000000016001476cf2330b5" +
        "1fc827dedb546101095fe7e0c4d1f697cb5b68000000001976a914698542" +
        "3d517c2a0ae945cdca7d13c837af3c3d1c88acfbdd5a5e000000001976a9" +
        "1492c164fb99153425969e739e025f9298face99ee88ac8a8af5c2050000" +
        "001976a9145463735174ece602807ecf6b55eaff78104ee7c188acddc883" +
        "66000000001976a9142a2cb34c69a72f6b41c16251bdd9e84a9aa4e55b88" +
        "acc378bc52010000001976a914e3694d08309b4087e784c2dee01086c3c4" +
        "52ee9d88ac04415b72010000001976a914b03aca91db9c7f9abc61c0fd7c" +
        "9969435af4552088ac0590ea4e000000001976a91411a8ece1e37075f69a" +
        "5c10257411111a504880f488ac4feb044b000000001976a914374794d70a" +
        "8d795168f80bd96cbe877464b7ba2c88ac8d825b5e000000001976a914f3" +
        "d08d08a11f968ddc43f096dd60b797c3774ef388ac5433195c0000000019" +
        "76a914013997702dbb5f4a6b06ebe580eb06d67e73dc2b88acf4ca885800" +
        "0000001976a91499759e500eb7885b10ca86dea22f9704e4243e1888ac70" +
        "e0ac1300000000160014be1b245309f08a8490b300980286f5bc4e0a05fd" +
        "2d6b7d51000000001976a9143b54569a3c39ecc121a6b516a95af3462634" +
        "cda188ac7808d84e000000001976a9149d2c245dd450333b112410a5c769" +
        "3b00dee1e93c88aca5e6fe61000000001976a914758fade21c666b249a14" +
        "23c1c7cdc4fa5b5a01bc88ac6c08ed5f000000001976a9143d661b080b8e" +
        "082442a4a316241e85f569ccfdf488ac7de07e5f000000001976a9149bce" +
        "3742c262169d9dda143e747336a4a3da754388acbbca445b000000001976" +
        "a9144447bb175199ea062483b1cce9e6d8111e096cf988ac519c315e0000" +
        "00001976a9147a6776d1225f4c19f0b859f1278a2200b22c51c388ac9b8a" +
        "975c000000001976a914fb5aaa0afac4cf10ef075bb4e53028b5e86e6013" +
        "88ac1a26875e000000001976a9149669afbb8bc92ce1b499705cc92687df" +
        "f98af13788ac8bad7650000000001976a914f52399f9bd08bf0076d2cb0c" +
        "52d34c3f6e70c0bc88ac8be42762000000001976a9147a7c616575c83b35" +
        "bc767a4603c3cb4943cd076988ac3202de52000000001976a914661d11aa" +
        "92705241b328f7acc48dfbb284d7cff888ac1660365e000000001976a914" +
        "1acdef0a5ee1a86ce4f3533d91fd688554050aa688acb500585f00000000" +
        "1976a914e0faf54c893996339d5cb0f1e905122161738cf688acfc483952" +
        "000000001976a914e3789a6b421ded77d52895dcf6f98efec0349c6f88ac" +
        "f545ab5f000000001976a91495a7d17a224aefbaaf8d9f62def4b4a5ae96" +
        "adff88aca3705d10a8000000220020d5c1005c0d4012d3ae2672319e7f9e" +
        "b15a57516aeefabbbc062265f67e308f2b0000000000000000266a24aa21" +
        "a9ed8bf163e45b0318f3d23430613f59ee0609e0dba1b1ea0d76f2ed16da" +
        "0fb17e600000000000000000326a3009f91102000002208145f7edb16852" +
        "fd4117925b905141f0a0ca0e6a928c5cd05eff43219057052bc615110000" +
        "000000012000000000000000000000000000000000000000000000000000" +
        "0000000000000000000000")

    def test_effective_target(self):
        cbc = packetcrypt_get_coinbase_commit(bfh(self.COINBASE_400000))
        hdr = deserialize_header(bfh(self.HEADER_400000), 400000)
        ann_tar = int.from_bytes(cbc[4:8], byteorder='little')
        block_tar = hdr['bits']
        ann_count = int.from_bytes(cbc[-8:], byteorder='little')
        self.assertEqual(block_tar, 0x1d26116a)
        self.assertEqual(ann_tar, 0x20020000)
        self.assertEqual(ann_count, 1119686)
        et = packetcrypt_get_effective_target(block_tar, ann_tar, ann_count)
        self.assertEqual(et, 0x1e01e797)

    def test_valid_proof(self):
        header_and_proof = bfh(self.HEADER_400000 + self.PROOF_400000)
        self.assertEqual(self.PREV_HEADER_NUMS, packetcrypt_ann_header_numbers(header_and_proof))
        packetcrypt_validate(
            self.PREV_HASHES,
            bfh(self.COINBASE_400000),
            header_and_proof,
            400000
        )
